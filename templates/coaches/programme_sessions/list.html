{% extends "base/base.html" %}
{% load i18n dates_text %}
{% block title %}
    - {% translate "Programme for " %} {{ athlete.user.name }}
{% endblock title %}
{% block heading %}
    {% include "components/athlete_card/avatar.html" with athlete=athlete %}
    {{ athlete.user.name }}'s {% translate "Programme" %}
{% endblock heading %}
{% block subheading %}
    {% translate "Today" %}, {% now "l - jS F Y" %}
{% endblock subheading %}
{% block content %}
    <div>
        <div class="block">
            <form method="post"
                hx-post="{{ athlete.get_hx_coach_programme_session_new_url }}"
                hx-target="#new-programmes"
                hx-swap="beforeend">
                {% csrf_token %}
                <button type="submit" class="button is-primary is-inverted is-outlined">
                    <span class="icon is-small">
                        <i class="fas fa-plus"></i>
                    </span>
                    <span>{% translate "New Programme" %}</span>
                </button>
            </form>
        </div>
        <div class="block">
            <form method="post"
                hx-post="{{ athlete.get_hx_coach_programme_session_week_duplicate_url }}"
                hx-target="#new-programmes"
                hx-swap="beforeend">
                {% csrf_token %}
                <button type="submit" class="button is-primary is-inverted is-outlined">
                    <span class="icon is-small">
                        <i class="fas fa-plus"></i>
                    </span>
                    <span>{% translate "Duplicate Week" %}</span>
                </button>
            </form>
        </div>
        <div id="new-programmes" class="block"></div>
        <div class="block">
            {% if programmes %}
                {% for year, months in programmes.items %}
                    {% for month, weeks in months.items %}
                        <div class="block">
                            <h3 class="title is-4">
                                {% month_text m=month as month_date %}
                                {{ month_date|date:"F" }}
                            </h3>
                            <p class="subtitle is-6">{{ year }}</p>
                        </div>
                        <hr />
                        {% for week, days in weeks.items %}
                            {% start_week week=week year=year as start_week %}
                        {% end_week week=week year=year as end_week %}
                        {% with week|slugify as week_number %}
                            {% now "W" as current_week %}
                            {% if current_week == week_number %}
                                <div class="section hero is-small is-success">
                                    <div class="is-flex is-justify-content-flex-end">
                                        <div class="block has-text-right">
                                            <p class="title is-4">{% translate "Week" %} {{ week }}</p>
                                            <p class="subtitle is-6">{{ start_week|date:"M jS" }} - {{ end_week|date:"M jS" }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="is-flex is-justify-content-flex-end">
                                    <div class="block has-text-right">
                                        <p class="title is-5">{% translate "Week" %} {{ week }}</p>
                                        <p class="subtitle is-7">{{ start_week|date:"M jS" }} - {{ end_week|date:"M jS" }}</p>
                                    </div>
                                </div>
                            {% endif %}
                        {% endwith %}
                        <hr />
                        <div class="tile is-ancestor">
                            {% for day, programmes in days.items %}
                                <div class="tile is-parent is-vertical">
                                    {% for programme in programmes.values %}
                                        <div class="tile is-child">
                                          <div class="box">
                                            {% include "coaches/programme_sessions/partials/programme_session_inline.html" with programme=programme %}
                                          </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                {% endfor %}
                {% endfor %}
            {% else %}
                <p>No Training Sessions.</p>
            {% endif %}
        </div>
    </div>
{% endblock content %}
